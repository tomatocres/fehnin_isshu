<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
#cards{
	display: grid;
	grid-template-columns: repeat(6, 1fr);
	max-width: 800px;
}
.disabled{
	background-color: silver; 
}
.failed{
	color: #cc0000; 
}
.card{
	border: 1px solid #cccccc;
	height: 3em;
}
#description{
	height: 300px;
	white-space: pre-wrap;
	border: 1px solid #cccccc;
}
</style>
</head>
<body>
	<div id="app">
		<div id="controller">
		{{message}} {{timer}}
		<button @click="reset();" align="Right">Reset</button>
		</div>
			<pre id="description" @click="click_description()">{{description}}</pre>
			<div id="cards">
				<card-text v-for="card in db_cards.slice(0,VISIBLE_CARDS)"  :card="card" :class="{disabled: card.disabled, failed: card.failed}" />
		</div>
	</div>
  <!--
	  <script src="https://unpkg.com/vue@next"></script>
<script src="https://unpkg.com/vue@2.5.17"></script>
  -->
	<script src="https://unpkg.com/vue@3.2.36/dist/vue.global.js"></script>
<script>

let db_skill=[];
db_skill.push({name:'絶光の角', description:`奥義が発動しやすい(発動カウント-1)
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、速さ、守備、魔防+5、絶対追撃、かつ、与えるダメージ+自分の守備の20%、受けるダメージ-自分の守備の20%、(範囲奥義を除く)
ターン開始時、竜、獣以外の味方と隣接していない場合、化身状態になる(そうでない場合、化身状態を解除)
化身状態なら、攻撃+2、かつ奥義発動時、奥義によるダメージ+7、戦闘中、敵の奥義発動カウント変動量+を無効、かつ自身の奥義発動カウント変動量-を無効
`});  
db_skill.push({name:'大地母神の聖書', description:`奥義が発動しやすい(発動カウント-1)
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、速さ+6、かつ、自身の奥義発動カウント変動量-を無効、ダメージ+敵の攻撃の10%、かつ、自分のHPが25%以上で敵の致死攻撃を受けた時、ダメージをHPが1残るように軽減(1戦闘1回のみ。奥義以外の「敵の致死攻撃を受けた時、ダメージをHPが1残るように軽減する効果」とは重複しない)
`});  
db_skill.push({name:'天馬姉妹の三角槍', description:`攻撃+3
【再移動(残り+1)】を発動可能
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、速さ、守備、魔防+5、自分が与えるダメージ+魔防の20%、かつ戦闘中、最初に受けた攻撃のダメージを40%軽減
`});  
db_skill.push({name:'永生のブレス', description:`攻撃+3
射程2の敵に、敵の守備か魔防の低い方でダメージ計算
応援、移動系補助(体当たり、引き戻し、回り込み等)を使用した時、または自分に使用された時、移動後の自分と相手の周囲2マスの味方のHP10回復、その後、【不利な状態異常】を解除(自分と相手を含む。自分と相手の範囲が重複していても効果は重複しない)
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃、速さ、守備魔防+5、絶対追撃
`});  
db_skill.push({name:'深き優しさの聖器', description:`奥義が発動しやすい(発動カウント-1)
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、速さ、守備、魔防+5、自身が受けている追撃不可を無効、かつ、敵の奥義発動カウント変動量-1(同系統効果複数時、最大値適用)、かつ戦闘中に攻撃していれば、戦闘後に敵と、その周囲2マス以内の敵に【キャンセル】を付与
`});  
db_skill.push({name:'夏氷のブレス', description:`射程2の敵に、敵の守備か魔防の低い方でダメージ計算
奥義が発動しやすい(発動カウント-1)
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、速さ+6、敵の絶対追撃を無効、かつ、自分の追撃不可を無効、かつ、速さが敵より5以上高い時、敵は反撃不可
`});  
db_skill.push({name:'戦神と戯神の気紛れ', description:`奥義が発動しやすい(発動カウント-1)
ターン開始時、周囲2マス以内に味方がいる時、自身の奥義発動カウント-1
ターン開始時、敵軍内で最も速さが低い敵と、その周囲2マス以内にいる敵に【弱点露呈】【空転】を付与(敵の次回行動終了時まで)
戦闘開始時、自身のHPが25%以上なら、攻撃+6、敵の攻撃-6
【弱点露呈】敵から受けた攻撃のダメージ+10
`});  
db_skill.push({name:'鎧好きの堅槍', description:`戦闘開始時、自身のHPが25%以上なら、戦闘中、敵の攻撃、守備-5、敵は追撃不可
敵から攻撃された時、または、戦闘開始時、敵のHPが75%以上の時、戦闘中、敵の攻撃、守備-5、かつ、戦闘中、敵の攻撃が、戦闘開始時の敵の攻撃×〇%減少
〇の値は、戦闘開始時の最大HP、攻撃、速さ、守備、魔防のうち、自分が敵より1以上高い種類数×5+10
`});  
db_skill.push({name:'黒斧ベルヴェルク', description:`奥義が発動しやすい(発動カウント-1)
ターン開始時、周囲2マス以内に味方が2人以上いる時、【見切り・追撃効果】、「戦闘中、奥義発動カウント変動量+1(同系統効果複数時、最大値適用)」を付与(1ターン)
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、速さ、守備、魔防+5、戦闘後、7回復
`});  
db_skill.push({name:'蒼波薙ぐ剛力の櫂', description:`【再移動(残り+1)】を発動可能
奥義が発動しやすい(発動カウント-1)
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃、速さ、守備、魔防+5、かつ敵が【有利な状態】の時、または速さが敵より10以上高い時、2回攻撃
`});  
db_skill.push({name:'純白の月の雫', description:`重装、騎馬特効
奥義が発動しやすい(発動カウント-1)
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、魔防+6、かつ、自分の魔防-敵の魔防の値によって異なる効果を発動(5以上14以下なら、自分から攻撃した時、自分は絶対追撃・15以上なら、自分から攻撃した時、2回攻撃)
`});  
db_skill.push({name:'真夏の涼の氷菓子', description:`【再移動(残り)】を発動可能
奥義が発動しやすい(発動カウント-1)
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、速さ+6、かつ、自分から攻撃した時、自分が受けている強化と敵が受けている弱化の合計値が12以上なら、2回攻撃
【暗器(7)】効果
`});  
db_skill.push({name:'強靭なる烈女の大傘', description:`奥義が発動しやすい(発動カウント1)
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃+6、敵の攻撃-6、最初に受けた攻撃のダメージを40%軽減、かつ、自身を中心とした縦3列と横3列の敵の人数が○人以上なら、2回攻撃
○は、敵軍の総数により変化(敵軍の総数が・6人以上なら、3、 ・3~5人なら、2、・2人以下なら、1)
`});  
db_skill.push({name:'被造フィンブル', description:`攻撃+3
周囲3マス以内に味方がいる時、戦闘中、敵の攻撃、魔防-8、かつ敵は追撃不可、かつ戦闘中、周囲3マス以内にいる味方のうち、攻撃と魔防の強化の合計値が最も高い味方の攻撃と魔防の強化の合計値を、自身の攻撃に加算
周囲3マス以内に味方がいる状態で攻撃した時、戦闘後、最も近い味方に15ダメージ
`});  
db_skill.push({name:'お調子者の碧槍', description:`【再移動(残り+1)】を発動可能攻撃+3
自分から攻撃した時、または周囲2マス以内に味方がいる時、戦闘中、攻撃、速さ+6
応援を使用した時、自分の攻撃、速さ+6(1ターン)、その後、自分を行動可能にする(1ターンに1回のみ)
`});  
db_skill.push({name:'友の風舞う翼弓', description:`飛行特効
奥義が発動しやすい(発動カウント-1)
自身のHPが60%以下の時、味方は、自身の周囲1マス以内に移動可能
周囲2マス以内の味方は、自身の周囲2マス以内に移動可能周囲3マス以内に味方がいる時、戦闘中、攻撃、速さ+6、かつ、ダメージ+速さの15%
`});  
db_skill.push({name:'竜神のブレス', description:`射程2の敵に、敵の守備か魔防の低い方でダメージ計算
奥義が発動しやすい(発動カウント-1)
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、敵の攻撃、速さ、守備、魔防-5、自分は絶対追撃、かつ、受けた範囲奥義のダメージと、戦闘中に攻撃を受けた時のダメージを30%軽減(巨影の範囲奥義を除く)
`});  
db_skill.push({name:'一途な想いの薔薇', description:`奥義が発動しやすい(発動カウント-1)
1ターン目開始時、奥義発動カウント-1
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、魔防+6、かつダメージ+自身の魔防の10%
`});  
db_skill.push({name:'竜血継ぐ花嫁の花', description:`攻撃+3
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃、速さ、守備、魔防+5、かつ、絶対追撃、かつ、無属性の敵と戦闘時、自分は3すくみ有利、敵は3すくみ不利となる
`});  
db_skill.push({name:'紅炎の親子の聖斧', description:`【再移動(2)】を発動可能
竜、獣特効
奥義が発動しやすい(発動カウント-1)
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、自身の攻撃、速さ、守備、魔防+5、かつ敵の攻撃、速さ、守備、魔防が自分が受けている強化の合計値の50%だけ減少(最大6)
`});  
db_skill.push({name:'暴走の虎の爪牙', description:`攻撃+3
ターン開始時、周囲4マス以内の敵の攻撃、速さ、守備、魔防-6(敵の次回行動終了まで)
戦闘開始時、敵のHPが75%以上の時、戦闘中、攻撃、速さ+6敵の強化を無効(無効になるのは、鼓舞や応援等の+効果)
2ターン目と、4ターン目以降のターン開始時、化身状態になる(そうでない場合、化身状態を解除)化身状態なら、攻撃+2、かつ奥義発動時奥義によるダメージ+7、戦闘中、敵の奥義発動カウント変動量+を無効、かつ自身の奥義発動カウント変動量-を無効
その状態で攻撃した時、戦闘後、自分に5ダメージ
`});  
db_skill.push({name:'透魔竜の力', description:`速さ+3
射程2の敵に、敵の守備か魔防の低い方でダメージ計算
自分と支援を結んでいる相手の周囲2マス以内のマスに移動可能
ターン開始時、周囲3マス以内に自分と支援を結んでいる相手がいる時、自分と、周囲3マス以内の自分と支援を結んでいる相手に【見切り・追撃効果】を付与(1ターン)
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃、速さ、守備、魔防+5
`});  
db_skill.push({name:'茫漠のブレス', description:`魔防+3
射程2の敵に、敵の守備か魔防の低い方でダメージ計算
「歌う」「踊る」使用時、自分と対象の十字方向にいる敵の攻撃､魔防-7【キャンセル】を付与(敵の次回行動終了まで)
戦闘開始時、自身のHPが25%以上の時、戦闘中、速さ、魔防+6
`});  
db_skill.push({name:'死斧グリトニル', description:`奥義が発動しやすい(発動カウント-1)
戦闘開始時、自身のHPが25%以上なら、戦闘中、敵の攻撃、速さ、守備-5、自身の奥義発動カウント変動量+1、敵の奥義発動カウント変動量-1(同系統効果複数時、最大値適用)､かつ、敵が反撃可能なら、または、敵から攻撃された時､絶対追撃
`});  
db_skill.push({name:'滅亡の霜雪', description:`射程2の敵に、敵の守備か魔防の低い方でダメージ計算
奥義が発動しやすい(発動カウント-1)
敵から攻撃された時、または、戦闘開始時、敵のHPが75%以上の時、戦闘中、自身の攻撃+6敵の攻撃-6、自分、敵､ともに追撃不可、自分が最初に与えるダメージ+敵の魔防の40%
`});  
db_skill.push({name:'氷槍マルテ', description:`ターン開始時、神竜の花を自身に使用した回数が10回以上なら、攻撃、守備+6(1ターン)
敵から攻撃された時、または、戦闘開始時、敵のHPが75%以上の時、戦闘中、攻撃、速さ、守備、魔防が神竜の花を自身に使用した回数によって最大+5上昇(使用した回数が1回以上なら+5、0回なら+4)、かつ、神竜の花を自身に使用した回数が5回以上なら、敵の奥義発動カウント変動量-1(同系統効果複数時、最大値適用)
周囲3マス以内に味方がいる時、戦闘中、攻撃、速さ、守備、魔防+4、かつ、攻撃、速さ、守備、魔防が自分が受けている攻撃、速さ、守備、魔防の強化の値だけ上昇(能力値ごとに計算)
`});  
db_skill.push({name:'暗黒地竜のブレス', description:`攻撃+3
射程2の敵に、敵の守備か魔防の低い方でダメージ計算
ターン開始時、自分と周囲2マス以内の味方の攻撃、魔防+6、かつ【戦闘外ダメージ無効】を付与(1ターン)
敵から攻撃された時、または、戦闘開始時、敵のHPが75%以上の時､戦闘中、敵の攻撃、魔防-6、敵は追撃不可
【戦闘外ダメージ無効】自身が受ける戦闘以外のダメージは0になる(蛇毒、雷の塔等)(範囲奥義を除く)
`});  
db_skill.push({name:'嘲謔ボルガノン', description:`魔防+3
ターン開始時、周囲4マス以内に敵がいる時、自分に【敵弱化ダメージ+】を付与、かつ最も近い敵の攻撃、魔防-6(敵の次回行動終了まで)
自分から攻撃した時、または、周囲1マス以内に味方がいない時、戦闘中、攻撃、魔防+6
【敵弱化ダメージ+】ダメージ+敵が受けている弱化の合計値(1ターン)
`});  
db_skill.push({name:'怒雷の紫書', description:`奥義が発動しやすい(発動カウント-1)
1～3ターン目開始時、または、ターン開始時、自身のHPが99%以下の時、奥義発動カウント-1
1～3ターン目の間、または、戦闘開始時、自身のHPが99%以下の時、戦闘中、攻撃、速さ+6、かつ、奥義発動時、奥義によるダメージ+7、かつ、奥義発動時、奥義以外のスキルによる「ダメージを○○%軽減」を無効(ダメージ加算、軽減無効は、範囲奥義を除く)
`});  
db_skill.push({name:'雷神トールハンマー', description:`奥義が発動しやすい(発動カウント-1)
戦闘開始時､自身のHPが25%以上なら、戦闘中、攻撃、速さ+6、かつ、敵の奥義発動カウント変動量+を無効、かつ、自身の奥義発動カウント変動量-を無効
戦闘開始時、自身のHPが25%以上なら、自分から攻撃した時、速さが敵より10以上高ければ、2回攻撃
`});  
db_skill.push({name:'戦神の鋭剣', description:`奥義が発動しやすい(発動カウント-1)
速さの差を比較するスキルの比較判定時、自身の速さ+10として判定
ターン開始時、周囲2マス以内に味方がいる時、自分に【見切り・追撃効果】、【回避】を付与(1ターン)
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、速さ、守備、魔防+5
【見切り・追撃効果】戦闘中、速さが敵より1以上高い時、敵の絶対追撃を無効、かつ、自分の追撃不可を無効(1ターン)
【回避】速さが敵より高い時、受けた範囲奥義のダメージと、戦闘中に攻撃を受けた時のダメージを速さの差×4%軽減(最大40%)(巨影の範囲奥義を除く)(1ターン)
`});  
db_skill.push({name:'戦神の戦術書', description:`奥義が発動しやすい(発動カウント-1)
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃、魔防+6、かつ、自分の魔防-敵の魔防の値によって異なる効果を発動(・1以上なら、自分は絶対追撃・5以上なら、さらに敵が剣、槍、斧、弓、暗器、獣の時、敵は反撃不可・10以上なら、さらに敵の奥義以外のスキルによる「ダメージを〇〇%軽減」を半分無効(無効にする数値は端数切捨て。例えば敵の「ダメージを45%軽減」なら半分の「22%」分を無効にし、「ダメージを23%軽減」にする))
`});  
db_skill.push({name:'戦神の風書', description:`魔防+3
敵から攻撃された時、または、戦闘開始時、敵のHPが75%以上の時、戦闘中、敵の攻撃、魔防-6、かつ、魔防が敵より高い時、受けた範囲奥義のダメージと、戦闘中に攻撃を受けた時のダメージを魔防の差×4%軽減(最大40%)(巨影の範囲奥義を除く)、さらに、魔防が敵より5以上高い時、敵は追撃不可
`});  
db_skill.push({name:'戦神の剛なる鉄剣', description:`攻撃+3
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃、速さ、守備、魔防+5、かつ、攻撃時発動の奥義装備時、周囲4マス以内の味方の人数によって異なる効果を発動(・1以上なら、自分の最初の攻撃前、自身の奥義発動カウントが、奥義発動カウントの最大値の半分だけ減少(減少値は端数切捨て)・2以上なら、さらに、最初に受けた攻撃のダメージを奥義発動カウントの最大値×10%軽減・3以上なら、さらに、敵の絶対追撃を無効、かつ、自分の追撃不可を無効)
`});  
db_skill.push({name:'戦神の大斧', description:`攻撃+3
奇数ターンなら、戦闘中、攻撃、速さ+10、かつ、自身の攻撃、速さの弱化を無効、かつ、最初に与えるダメージ+攻撃の15%
偶数ターンなら、戦闘中、攻撃、速さ+5
`});  
db_skill.push({name:'大地の剣', description:`攻撃+3
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃、速さ+6、かつ、自分の追撃不可を無効、かつ、敵は、「敵から攻撃を受ける際に発動する奥義」を「ダメージを〇〇%軽減」を無効(範囲奥義を除く)
戦闘開始時、自身のHPが25%以上なら、戦闘後、HP7回復
`});  
db_skill.push({name:'軍師の諫言の杖', description:`杖は他の武器同様のダメージ計算になる
ターン開始時、支援相手の攻撃、守備、魔防+6、かつ、「自分から攻撃時、絶対追撃」の状態を付与
ターン開始時、味方が1人以上撃破されている時、支援相手の奥義発動カウント-2、かつ、「敵は追撃不可」を付与
`});  
db_skill.push({name:'花開く心技の剣', description:`奥義が発動しやすい(発動カウント-1)
1ターン目開始時、奥義発動カウント-1
戦闘開始時、自身のHPが25%以上なら、戦闘後、奥義発動カウント-1
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃、速さ、守備、魔防+5、かつ、敵の絶対追撃を無効、かつ、自分の追撃不可を無効
`});  
db_skill.push({name:'可憐に色づく飾り卵', description:`奥義が発動しやすい(発動力ウント-1)
ターン開始時、自分の周囲5マス以内にいる最も近い敵の速さ、魔防-6(敵の次回行動終了まで)
自分が【有利な状態】の時、または、敵が【不利な状態異常】を受けている時、戦闘中、敵の速さ、魔防-6、かつ、自分の強化の合計値+敵の弱化の合計値によって異なる効果を発動(・6以上なら、自分が受けている追撃不可を無効・18以上なら、さらに、敵は反撃不可)(例えば、自分の強化が攻撃、速さ+6. 敵の弱化が攻撃、速さ-6なら、 強化の合計値+弱化の合計値は24となる)
【有利な状態】「1ターン」の効果全般 (強化、移動+1、敵弱化ダメージ+等)
【不利な状態異常】「敵の次回行動終了まで」の効果全般(弱化、移動制限、パニック、反撃不可、 相性激化、キャンセル等)
`});  
db_skill.push({name:'無邪気な白兎の斧', description:`飛行特効無効
守備+3
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃、速さ、守備、魔防+5、かつ、与えるダメージ+自分の守備の20%、受けるダメージ-自分の守備の20%、(範囲奥義除く)、かつ、戦闘後、自分と周囲2マスの味方を7回復
`});  
db_skill.push({name:'二羽の魔兎の揺籃', description:`奥義が発動しやすい(発動カウント-1)
1ターン目開始時、奥義発動カウント-2
周囲2マス以内の味方の、周囲2マス以内に移動可能
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃+4、速さ+6、自分の攻撃+(自分の奥義発動カウントの最大値×3)
`});  
db_skill.push({name:'蒼穹の細槍', description:`自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、速さ+5、自分が与えるダメージ+7
応援、移動系補助(体当たり、引き戻し、回り込み等)を使用した時、または自分に使用された時、自分と相手の攻撃、速さ+6(1ターン)、かつ、HP10回復
戦闘開始時、敵のHPが75%以上なら、戦闘中、攻撃、速さ+5
`});  
db_skill.push({name:'颯弓ミュルグレ', description:`飛行特効
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、速さ+5、かつ、速さが敵より5以上高い時、敵は反撃不可
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃、速さ+5、戦闘中、最初に与えるダメージ+速さの15%
戦闘開始時、自身のHPが25%以上なら、自分から攻撃した時、戦闘中に攻撃していれば、戦闘後に敵と、その周囲2マスの敵に7ダメージ
`});  
db_skill.push({name:'慈母の霊杖', description:`敵は反撃不可
自分から攻撃した時、戦闘中、攻撃、速さ+4
戦闘中に攻撃していれば、戦闘後に敵と、その周囲2マスの敵に反撃不可の状態異常を付与(敵の次回行動終了まで)
自分の周囲4マス以内で、再移動を発動した敵に【再移動制限】を付与
【再移動制限】自分から攻撃、補助、地形破壊の行動をした後、直後に移動できる効果を制限する状態異常(敵の次回行動終了まで)。この状態異常を受けている敵の射程が1の時、直後に移動できる距離を最大1に制限。この状態異常を受けている敵の射程が2の時、再移動発動直後、行動を終了する
`});  
db_skill.push({name:'扶翼ウイングスピア', description:`【再移動(2)】を発動可能
重装、騎馬特効
攻撃+3
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、速さ、守備、魔防+5、かつ、敵が強化を受けていれば、戦闘中、自身の攻撃、速さ、守備、魔防が敵が受けている強化の値だけ上昇し、敵の攻撃、速さ、守備、魔防が敵が受けている強化の値だけ減少(能力値ごとに計算)
【再移動(2)】自分から攻撃、補助、地形破壊の行動をした後、直後に2マス移動できる(自身の移動タイプで移動。例:歩行は、林に移動しづらい)(攻撃、補助、地形破壊不可)(同系統効果複数時、最大値適用)(1ターンに1回のみ)(行動直後に再行動可能にするスキル発動時は、再行動で条件を満たせば、再移動が可能)(再移動できる距離は、通常の移動の距離とは無関係)(2マスを超える距離のワープ移動はできない)
`});  
db_skill.push({name:'雇われ魔道士の書', description:`速さ+3
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃、速さ、守備、魔防が神竜の花を自身に使用した回数によって最大+7上昇(使用回数が5回以上なら+7、4回なら+6、3回なら+5、2回以下なら+4)
戦闘開始時、自身のHPが25%以上、かつ、神竜の花を自身に使用した回数が3回以上なら、さらに戦闘中、攻撃、速さ、守備、魔防が自分が受けている攻撃、速さ、守備、魔防の強化の値だけ上昇(能力値ごとに計算)
`});  
db_skill.push({name:'芽生えし心の竜石', description:`重装特効
重装特効無効
射程2の敵に、敵の守備か魔防の低い方でダメージ計算
奥義が発動しやすい(発動カウント-1)
周囲3マス以内に味方がいる時、戦闘中、敵の攻撃、速さ、守備、魔防-5、自身の弱化を無効、敵は追撃不可
`});  
db_skill.push({name:'ケルムト', description:`攻撃+3
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃+6、敵の攻撃-6、絶対追撃、かつ、戦闘中、敵の攻撃、速さ、守備、魔防が下記の条件を満たしている数×3だけ減少(最大9)(条件A:自分の周囲3マス以内に味方がいる。条件B:戦闘相手の周囲2マス以内に他の敵がいる。条件C:自分が有利な状態を受けている。条件D:敵が不利な状態異常を受けている)
`});  
db_skill.push({name:'運命変える絆弓', description:`重装、飛行特効
奥義が発動しやすい(発動カウント-1)
1～4ターン目に移動系補助(体当たり、引き戻し、回り込み等)を使用した時、または自分に使用された時、自分と相手の奥義発動カウント-1(1ターン1回のみ)
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、速さ、守備、魔防+5、絶対追撃
`});  
db_skill.push({name:'ガーベラの斧', description:`速さ+3
移動系補助(体当たり、引き戻し、回り込み等)を使用した時、または自分に使用された時、自分と相手に「敵の強化の+を無効」の状態を付与(1ターン)
敵から攻撃された時、または、戦闘開始時、敵のHPが75%以上の時、戦闘中、攻撃、速さ、守備、魔防+5、かつ、戦闘中、最初に受けた攻撃のダメージを40%軽減
`});  
db_skill.push({name:'アキメネスの花冠', description:`奥義が発動しやすい(発動カウント-1)
自分を除く自軍内の移動タイプの種類数によって異なる効果を発動(・1以上なら、周囲3マス以内の敵は、戦闘中、攻撃、守備、魔防-5・2以上なら、さらに自分は戦闘中、最初に受けた攻撃のダメージを30%軽減・3以上なら、さらに自分と周囲3マス以内の味方は、戦闘中、自分の攻撃でダメージを与えた時、5回復)(与えたダメージが0でも効果は発動)
`});  
db_skill.push({name:'純理の書', description:`ターン開始時、周囲2マス以内に味方がいる時、自分と周囲2マス以内の味方の守備、魔防+6(1ターン)
戦闘開始時、自身のHPが25％以上なら、戦闘中、攻撃、速さ、守備、魔防+4
自分から攻撃した時、または、周囲2マス以内に味方がいる時、戦闘中、攻撃、速さ、守備、魔防+4、かつ、自分が強化を受けていれば、戦闘中、敵の攻撃、魔防が自分が受けている守備と魔防の強化の合計値の60%だけ減少
`});  
db_skill.push({name:'ヴェルダンの荒弓', description:`飛行特効
奥義が発動しやすい(発動カウント-1)
自分から攻撃した時、または、周囲1マス以内に味方がいない時、戦闘中、攻撃、速さ+5
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃、速さ+5
自分から攻撃した時、自分の速さ-敵の速さの値によって異なる効果を発動(・3以上なら、自分は絶対追撃・7以上なら、さらに追撃可能なら自分の追撃の直後に追撃を行う)
`});  
db_skill.push({name:'疾風の暗器', description:`戦闘中、敵が受けている強化の合計値を攻撃に加算
戦闘開始時、敵のHPが75%以上の時、または、敵が【有利な状態】の時、戦闘中、攻撃、速さ+5
【暗器(7)】効果
【有利な状態】「1ターン」の効果全般(強化、移動+1、敵弱化ダメージ+等)
【暗器(7)】戦闘中に攻撃していれば、戦闘後に敵と、その周囲2マスの敵の守備、魔防-7(敵の次回行動終了まで)
戦闘開始時、自身のHPが25%以上なら、戦闘中、攻撃、速さ+5
戦闘開始時、自身のHPが25%以上なら、速さが敵より高い時、受けた範囲奥義のダメージと、戦闘中に攻撃を受けた時のダメージを速さの差×3%軽減(最大30%)(巨影の範囲奥義を除く)、かつ、自分が与えるダメージ+5(戦闘前奥義も含む)
`});

const text_description_rule = `開始すると専用武器が並べられ、5秒後に始まります。

専用武器の説明文に合う武器を選んでください。
錬成可能なものは錬成後の文になります。
（無い場合は「なし」を選んでください。）

正解する、または2回間違えると次の武器に進みます。
10回正解するとクリアです。 

`

const MAX_CHOICE = 24
const UNSEEN_ANSWER = 2

let answers=[]
let db_cards=[]
let wrong_log = []
let state = {newGame: true, clear: false}
let visible_chars = 0

let correct_count = 0
let temporary_disabled = null

function rand_seq(length, begin=0){
	let rands_pair = [];
	for(let i=0; i<length; i++){
		rands_pair.push( {id: i, val: Math.random()})
	}
	rands_pair.sort( (a,b)=>a.val - b.val );
	return rands_pair.map( (x)=>(x.id + begin) );
}

function start_game(){
	db_cards = [{name:"なし", description:"", disabled:false}];
	let randtmp = rand_seq(db_skill.length);
	for(let i=0; i<MAX_CHOICE+UNSEEN_ANSWER-1; i++){
		db_cards.push(db_skill[randtmp[i]]);
		db_cards[i].disabled = false
		db_cards[i].failed = false
	}
	vm.db_cards = db_cards // why this tautology is needed?
	answers=rand_seq(MAX_CHOICE+UNSEEN_ANSWER-1, 1);
	state.newGame = false;
	vm.timer_active = true
	vm.base_time = Date.now()+5000 // measure after the count-down.
	countdown_to_start(5)
	// countdown_to_start(0);
}

function countdown_to_start(duration){
	if (duration > 0){
		vm.description = text_description_rule + "  " + duration
		// console.log(duration)
		vm.setTimeout_ID = setTimeout(countdown_to_start, 1000, duration-1)
	}else{
		vm.message = "スタート！ 残り:" + (10-correct_count) + "問"
		question()
		vm.setTimeout_ID = setTimeout(vm.timer_callback, 50)
	}
}

function correct_answer(message_part){
	if (temporary_disabled){
		temporary_disabled.card.disabled = false
		temporary_disabled = null
	}

	correct_count += 1
	if (correct_count < 10){
		vm.message = message_part + "残り:" + (10-correct_count) + "問"
		answers.shift()
		question()
	}else{
		gameclear(message_part)
	}
}

function gameclear(message_part){
	clearTimeout(vm.setTimeout_ID)
	vm.setTimeout_ID = null
	vm.timer_value = Date.now() - vm.base_time
	vm.message = message_part + "GAME CLEAR!"

	vm.VISIBLE_CARDS = MAX_CHOICE + UNSEEN_ANSWER
	
	for (let card_no of wrong_log){
		vm.db_cards[card_no].failed = true
	}
	
	state.clear = true
}

function wrong_answer(clicked_card){
	if (temporary_disabled){
		vm.message = "不正解(2回目):" + clicked_card.card.name + " 残り: " + (10-correct_count)
		temporary_disabled.card.disabled = false
		temporary_disabled = null
		wrong_log.push(answers[0])
		answers.push(answers.shift())
		question()
	}else{
		vm.message = "不正解(1回目):" + clicked_card.card.name + " 残り: " + (10-correct_count)
		temporary_disabled = clicked_card
		temporary_disabled.card.disabled = true
	}
}

function question(){
	// vm.description = vm.db_cards[answers[0]].description
	vm.question_start_time = Date.now()
}

const app = Vue.createApp({
	methods: {
		click_description(){
			if(state.newGame){
				start_game();
			}else{
				console.log("clicked but ignored");
			}
		},
		timer_callback(){
			now = Date.now()
			if(this.timer_active){
				this.timer_value = now - this.base_time
				this.setTimeout_ID = setTimeout(this.timer_callback, 47)
				// console.log(this.setTimeout_ID)
			}
			vm.description = vm.db_cards[answers[0]].description.slice(0, Math.floor((now - vm.question_start_time)/30))
		},
		reset(){
			answers=[]
			db_cards=[]
			state = {newGame: true, clear: false}
			visible_chars = 0

			correct_count = 0
			temporary_disabled = null

			clearTimeout(vm.setTimeout_ID)
			Object.assign(this.$data, app._component.data())
			
		}
	},
	data() {
		return ({
			message: "ルール説明",
			db_cards: db_cards,
			description: text_description_rule,
			VISIBLE_CARDS: MAX_CHOICE,
			base_time: Number.MAX_SAFE_INTEGER,
			timer_active: false,
			timer_value: 0,
			setTimeout_ID: null
		})
	},
	computed: {
		timer: function(){
			let mills

			if(this.timer_value <= 0){
				return ("0.000")
			}else{
				return Math.floor(this.timer_value/1000).toString() + "." + this.timer_value.toString().slice(-3)
			}
		}
	}
})

app.component('card-text', {
	props: ['card'], 
	template: `<div @click='choose("{{card.name}}")' class="card">{{card.name}}</div>`,
	methods: {
		choose(name){
			if (state.clear){
				vm.description = this.card.description
			}else if(! this.card.disabled && state.newGame == false){
				if (this.card.name == "なし"){
					for(let i=1; i<MAX_CHOICE; i++){
						if(vm.db_cards[i].description == db_cards[answers[0]].description) {
							wrong_answer(this)
							return;
						}
					}
					// no "return" executed 
					correct_answer("正解！" + db_cards[answers[0]].name + "(未配置) ")
				}else{
					if(this.card.description == db_cards[answers[0]].description) {
						this.card.disabled = true
						correct_answer("正解！" + db_cards[answers[0]].name + " ")
					}else{
						wrong_answer(this)
					}
					
				}
			}
		}
	},
})
const vm = app.mount('#app');
</script>
</body>
</html>
